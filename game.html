<html> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"/> <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script> <link rel="stylesheet" href="styles.css"/> <script type="text/javascript">
		function fixBoards(){
			$('.square').each(function(){
				var $this = $(this);
				$this.height($this.width());
			});
		}

		$(function(){

			$(window).resize(function () {
				fixBoards();
			});

			// decide which json to load from game id (in url)
			var id = (new window.URLSearchParams(window.location.search)).get('id');
            var collection = (new window.URLSearchParams(window.location.search)).get('collection');
            var batch = Math.trunc(id / 10);

            $.ajax("/data_" + collection + "/game" + batch + ".json").done(function(data) {
				var $content = $('#content');
				$content.html("");

				// decide which game to load from game id (in url)

				var game = data[id];
                var infoElem = null;

				$.each(game, function(idx, item){
                    switch (item.T) {
						case 0:

							infoElem = item;

							var $elem = $('<div class="ch-info row"></div>');

							var $inner = $('<div class="col"></div>')
							var info = item.I;
							var infoHtml = info[0] +
								"<br />" + info[1] + 
								"<br />" + info[2] + " - " + info[3] +
								"<br />" + info[4];

                            var titleHtml = info[2] + " " + info[5] + " " + info[3] + " (" + info[4] + ")";

                            $inner.html(infoHtml);
							$elem.html($inner);

							$content.append($elem);

                            document.title = titleHtml;

							break;
						case 1:

							var $elem = $('<div class="ch-moves container"></div>');

							$.each(item.M, function(idx, item) {
								var $move = $('<div class="ch-move row"></div>');

								$.each(item.P, function(idx, ply) {
									var $ply = $('<div class="ch-ply col"></div>');

									var $inner = $('<div class="' + (idx == 0 ? 'float-right' : 'float-left') + '"></div>')

									$inner.text(ply);
									$ply.html($inner);

									$move.append($ply);
								});


								$elem.append($move);

							});


							$content.append($elem);

							break;
						case 2:

							var $elem = $('<div class="ch-position board-container board"></div>');
							var respBoard = '';

							var freeSq = 0;
                            var fen = item.S;
							var idx = 0;

							for(var y = 0; y < 8; ++y)
							{
								//respBoard += '<div class="row">';
								for(var x = 0; x < 8; ++x) {
									var	sq = '';
									var piece = '';


									if (y % 2 == 0) {
										sq = x % 2 == 0 ? 'light-square' : 'dark-square';
									}
									else {
										sq = x % 2 == 0 ? 'dark-square' : 'light-square';
									}

									if (freeSq == 0){
										var c = fen[idx];
										if (isNaN(c)) {
											if (c.toUpperCase() == c) {
												piece = 'w' + c.toLowerCase();
											} else {
												piece = 'b' + c;
											}
										} else {
											freeSq = (+c) - 1; // consume own free square
										}

										++idx;
									}
									else {
										--freeSq;
									}


									respBoard += '<div class="square ' + sq + '"><div class="piece-container ' + piece + '"></div></div>';
								}
								//
								//respBoard += '</div>';

								if (fen[idx] == "/") {
									++idx;
								}
							}

							$elem.html(respBoard);

							$content.append($elem);

							break;						
					}
				});
								
                var $elem = $('<div class="ch-result row"></div>');
				var $inner = $('<div class="col"></div>');
				var result = "?";
				if (infoElem != null) {
					result = infoElem.I[5];
                }
                $inner.html(result);
                $elem.html($inner);
                $content.append($elem);

				fixBoards();
			});
		});

    </script> </head> <body> <div id="content" class="container"> </div> </body> </html>